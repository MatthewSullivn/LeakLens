<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEAKLENS - Surveillance Analysis</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0f0f0f;
            --bg-tertiary: #1a1a1a;
            --border-color: #2a2a2a;
            --border-subtle: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #888888;
            --solana-purple: #9945FF;
            --solana-green: #00ff88;
            --danger: #ff4444;
            --warning: #ffaa00;
            --success: #00ff88;
            --info: #3b82f6;
            --yellow: #ffd700;
            --glow-purple: rgba(153, 69, 255, 0.15);
            --glow-green: rgba(0, 255, 136, 0.15);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'JetBrains Mono', 'Space Grotesk', -apple-system, BlinkMacSystemFont, monospace, sans-serif;
            background: var(--bg-primary);
            background-image: 
                linear-gradient(rgba(20, 20, 20, 0.8) 1px, transparent 1px),
                linear-gradient(90deg, rgba(20, 20, 20, 0.8) 1px, transparent 1px);
            background-size: 24px 24px;
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Top Header Bar */
        .top-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .header-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .target-address {
            font-family: 'JetBrains Mono', monospace;
            color: var(--solana-green);
            font-weight: 400;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            background: rgba(20, 241, 149, 0.15);
            border: 1px solid rgba(20, 241, 149, 0.3);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            color: var(--solana-green);
            text-transform: uppercase;
        }
        
        .status-badge::before {
            content: '‚óè';
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .tag-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            color: var(--danger);
            text-transform: uppercase;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .header-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--border-subtle);
        }
        
        .header-btn.primary {
            background: linear-gradient(135deg, var(--solana-purple), #7c3aed);
            border: none;
        }
        
        .header-btn.danger {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.3);
            color: var(--danger);
        }
        
        .header-btn.danger:hover {
            background: rgba(239, 68, 68, 0.25);
        }
        
        .header-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
        }
        
        .header-icon:hover {
            background: var(--bg-secondary);
        }
        
        .container {
            position: relative;
            z-index: 1;
            max-width: 1920px;
            margin: 0 auto;
            padding: 0;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .logo-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--solana-purple), var(--solana-green));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 8px 32px var(--glow-purple);
        }
        
        .logo-text {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #a1a1aa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.02em;
        }
        
        .tagline {
            font-size: 20px;
            color: var(--text-secondary);
            font-weight: 400;
            margin-bottom: 12px;
        }
        
        .tagline span {
            color: var(--solana-green);
            font-weight: 600;
        }
        
        .powered-by {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 100px;
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .powered-by img {
            height: 16px;
        }

        /* Mission Section */
        .mission-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 28px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        }

        .mission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
        }

        .mission-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.2s;
        }

        .mission-card:hover {
            border-color: rgba(153, 69, 255, 0.35);
            transform: translateY(-2px);
        }

        .mission-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mission-card p {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .mission-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mission-list li {
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .mission-list li span {
            color: var(--solana-green);
            font-weight: 600;
        }
        
        /* ==================== SEARCH ==================== */
        .search-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 24px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            display: block !important;
            visibility: visible !important;
        }
        
        .search-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .search-subtitle {
            color: var(--text-secondary);
            margin-bottom: 28px;
            font-size: 15px;
        }
        
        .search-form {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .input-wrapper {
            flex: 1;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 14px 20px;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-primary);
            transition: all 0.2s;
            pointer-events: auto !important;
            z-index: 10;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--solana-purple);
            box-shadow: 0 0 0 4px var(--glow-purple);
        }
        
        .search-input::placeholder {
            color: var(--text-muted);
        }
        
        .network-badge {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: linear-gradient(135deg, rgba(153, 69, 255, 0.15), rgba(20, 241, 149, 0.15));
            border: 1px solid rgba(153, 69, 255, 0.3);
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            color: var(--solana-green);
        }
        
        .network-badge img {
            width: 18px;
            height: 18px;
        }
        
        .search-btn {
            background: linear-gradient(135deg, var(--solana-purple), #7c3aed);
            border: none;
            border-radius: 8px;
            padding: 14px 28px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            pointer-events: auto !important;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(153, 69, 255, 0.4);
        }
        
        .search-btn:active {
            transform: translateY(0);
        }
        
        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Limit Slider */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
        }
        
        .slider-label {
            font-size: 14px;
            color: var(--text-secondary);
            white-space: nowrap;
        }
        
        .slider-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .limit-slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }
        
        .limit-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--solana-purple), var(--solana-green));
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .limit-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 0 16px var(--glow-purple);
        }
        
        .limit-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--solana-purple), var(--solana-green));
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        .slider-value {
            min-width: 80px;
            padding: 8px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 600;
            color: var(--solana-green);
            text-align: center;
        }
        
        /* ==================== LOADING ==================== */
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(9, 9, 11, 0.95);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 24px;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-spinner {
            width: 64px;
            height: 64px;
            border: 3px solid var(--border-color);
            border-top-color: var(--solana-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .loading-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 15px;
            color: var(--solana-green);
        }
        
        .loading-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 16px;
        }
        
        .loading-step {
            font-size: 13px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .loading-step.active {
            color: var(--solana-green);
        }
        
        .loading-step.done {
            color: var(--success);
        }
        
        /* ==================== RESULTS ==================== */
        #results {
            display: none;
        }
        
        #results.active {
            display: block;
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Exposure Header */
        .exposure-header {
            background: linear-gradient(135deg, var(--bg-secondary), rgba(153, 69, 255, 0.05));
            border: 1px solid var(--border-subtle);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }
        
        .exposure-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, var(--glow-purple), transparent 70%);
            opacity: 0.5;
        }
        
        .wallet-info {
            position: relative;
            z-index: 1;
            margin-bottom: 32px;
        }
        
        .wallet-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        
        .wallet-address {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .copy-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .copy-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }
        
        .score-section {
            display: flex;
            align-items: center;
            gap: 32px;
            position: relative;
            z-index: 1;
        }
        
        .score-ring {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--bg-primary);
        }
        
        .score-ring::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            padding: 4px;
            background: conic-gradient(var(--score-color, var(--danger)) var(--score-pct, 0%), var(--border-color) 0%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }
        
        .score-value {
            font-size: 42px;
            font-weight: 700;
            line-height: 1;
        }
        
        .score-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        .score-details h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .score-details p {
            color: var(--text-secondary);
            font-size: 15px;
            max-width: 500px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 800px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 24px;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-subtle);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .card-title .icon {
            font-size: 22px;
        }
        
        .card-badge {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 13px;
            font-weight: 600;
        }
        
        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }
        
        @media (max-width: 800px) {
            .grid-2 { grid-template-columns: 1fr; }
            .score-section { flex-direction: column; text-align: center; }
        }
        
        /* What They Know */
        .knowledge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
        }
        
        .knowledge-item {
            background: var(--bg-primary);
            border-radius: 14px;
            padding: 20px;
            border-left: 4px solid var(--warning);
        }
        
        .knowledge-category {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--warning);
            margin-bottom: 8px;
        }
        
        .knowledge-fact {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .knowledge-explanation {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        /* Surveillance Vectors */
        .vector-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .vector-item {
            display: flex;
            gap: 16px;
            padding: 18px;
            background: var(--bg-primary);
            border-radius: 14px;
            border-left: 4px solid var(--danger);
            transition: all 0.2s;
        }
        
        .vector-item:hover {
            transform: translateX(4px);
        }
        
        .vector-icon {
            width: 44px;
            height: 44px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .vector-content h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .vector-content p {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        
        .vector-evidence {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
        }
        
        /* Heatmap */
        .heatmap-container {
            overflow-x: auto;
            padding-bottom: 8px;
        }
        
        .heatmap {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 4px;
            min-width: 600px;
        }
        
        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 6px;
            background: var(--bg-tertiary);
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.2);
            z-index: 1;
        }
        
        .heatmap-cell.l1 { background: rgba(239, 68, 68, 0.2); }
        .heatmap-cell.l2 { background: rgba(239, 68, 68, 0.4); }
        .heatmap-cell.l3 { background: rgba(239, 68, 68, 0.6); }
        .heatmap-cell.l4 { background: rgba(239, 68, 68, 0.8); }
        .heatmap-cell.l5 { background: var(--danger); }
        
        .heatmap-labels {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 4px;
            margin-top: 8px;
            min-width: 600px;
        }
        
        .heatmap-labels span {
            font-size: 10px;
            color: var(--text-muted);
            text-align: center;
        }
        
        /* Profile Bars */
        .profile-item {
            margin-bottom: 16px;
        }
        
        .profile-item:last-child {
            margin-bottom: 0;
        }
        
        .profile-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .profile-header .label {
            color: var(--text-secondary);
        }
        
        .profile-header .value {
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .profile-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .profile-bar .fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-out;
        }
        
        /* Protocol Pills */
        .protocol-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .protocol-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: linear-gradient(135deg, rgba(153, 69, 255, 0.1), rgba(20, 241, 149, 0.05));
            border: 1px solid rgba(153, 69, 255, 0.2);
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .protocol-pill:hover {
            transform: translateY(-2px);
            border-color: var(--solana-purple);
        }
        
        .protocol-pill .icon {
            font-size: 18px;
        }
        
        /* Jupiter Portfolio */
        .token-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .token-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px;
            background: var(--bg-primary);
            border-radius: 12px;
        }
        
        .token-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .token-info {
            flex: 1;
        }
        
        .token-name {
            font-weight: 600;
            font-size: 15px;
        }
        
        .token-amount {
            font-size: 13px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .token-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--success);
        }

        /* Snapshot + Insights */
        .snapshot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 14px;
        }

        .snapshot-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 16px;
        }

        .snapshot-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .snapshot-value {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .snapshot-subtext {
            font-size: 12px;
            color: var(--text-muted);
        }

        .meta-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px 16px;
            margin-top: 16px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .meta-pill {
            padding: 6px 12px;
            border-radius: 999px;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Link tiles */
        .link-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
        }

        .link-tile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            text-decoration: none;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .link-tile:hover {
            border-color: var(--solana-purple);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .link-tile .icon {
            font-size: 20px;
        }

        .link-tile .label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .link-tile .desc {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Breakdown bars */
        .breakdown-list {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .breakdown-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .breakdown-label {
            min-width: 160px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .breakdown-bar {
            flex: 1;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 999px;
            overflow: hidden;
        }

        .breakdown-fill {
            height: 100%;
            border-radius: 999px;
        }

        .breakdown-value {
            min-width: 42px;
            text-align: right;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Risk list */
        .risk-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .risk-item {
            display: flex;
            gap: 12px;
            padding: 14px;
            background: var(--bg-primary);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
        }

        .risk-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background: rgba(245, 158, 11, 0.12);
            color: var(--warning);
        }

        .risk-content h4 {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .risk-content p {
            font-size: 12px;
            color: var(--text-muted);
        }

        .risk-tag {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            margin-left: auto;
        }

        /* CTA tiles */
        .cta-tiles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
            margin-top: 24px;
        }

        .cta-tile {
            padding: 16px;
            border-radius: 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            text-decoration: none;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            gap: 6px;
            transition: all 0.2s;
        }

        .cta-tile strong {
            color: var(--text-primary);
            font-size: 15px;
        }

        .cta-tile.primary {
            background: linear-gradient(135deg, rgba(20, 241, 149, 0.18), rgba(153, 69, 255, 0.15));
            border-color: var(--solana-green);
            color: var(--text-primary);
        }

        .cta-tile:hover {
            transform: translateY(-2px);
            border-color: var(--solana-purple);
        }

        .cta-tile.secondary {
            background: var(--bg-primary);
        }

        /* Playbook */
        .playbook-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 12px;
        }

        .playbook-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 16px;
        }

        .playbook-item h4 {
            font-size: 14px;
            margin-bottom: 6px;
        }

        .playbook-item p {
            font-size: 12px;
            color: var(--text-muted);
        }

        .protect-banner {
            background: linear-gradient(135deg, rgba(153, 69, 255, 0.12), rgba(20, 241, 149, 0.12));
            border: 1px solid rgba(153, 69, 255, 0.35);
            border-radius: 18px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .protect-banner h4 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .protect-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .protect-step {
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 14px;
        }

        .protect-step strong {
            font-size: 13px;
            display: block;
            margin-bottom: 6px;
        }

        .protect-step p {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* CTA Section */
        .cta-section {
            background: linear-gradient(135deg, rgba(20, 241, 149, 0.1), rgba(153, 69, 255, 0.1));
            border: 2px solid var(--solana-green);
            border-radius: 24px;
            padding: 48px;
            text-align: center;
            margin-top: 32px;
        }
        
        .cta-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .cta-section h3 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .cta-section p {
            color: var(--text-secondary);
            font-size: 16px;
            max-width: 600px;
            margin: 0 auto 28px;
        }
        
        .cta-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--solana-green), #059669);
            color: #000;
            padding: 16px 32px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .cta-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(20, 241, 149, 0.4);
        }
        
        /* External Links */
        .external-links {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        
        .ext-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .ext-link:hover {
            border-color: var(--solana-purple);
            color: var(--text-primary);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 48px 24px;
            margin-top: 48px;
            border-top: 1px solid var(--border-subtle);
        }
        
        .footer p {
            color: var(--text-muted);
            font-size: 14px;
        }
        
        .footer a {
            color: var(--solana-green);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        /* Chart */
        .chart-container {
            height: 200px;
            position: relative;
        }
        
        /* Arkham Section */
        .arkham-box {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), transparent);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .arkham-title {
            font-size: 13px;
            font-weight: 600;
            color: #a78bfa;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .entity-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .entity-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(139, 92, 246, 0.15);
            border-radius: 8px;
            font-size: 13px;
            color: #c4b5fd;
        }
        
        /* Educational sections responsive */
        @media (max-width: 800px) {
            .card > div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Link hover effects */
        #arkham-links a:hover {
            background: var(--bg-secondary) !important;
            transform: translateX(4px);
        }
    </style>
</head>
<body>
    <!-- Top Header Bar -->
    <div class="top-header">
        <div class="header-left">
            <div class="header-title">
                LEAKLENS // TARGET: <span class="target-address" id="header-address">-</span>
            </div>
            <div class="status-badge" id="status-badge" style="display: none;">LIVE SURVEILLANCE ACTIVE</div>
            <div class="tag-badge" id="tag-badge" style="display: none;">SUSPECTED DEV</div>
        </div>
        <div class="header-right">
            <button class="header-btn" onclick="exportReport()">EXPORT REPORT</button>
            <button class="header-btn danger" onclick="escalateTarget()">ESCALATE</button>
            <div class="header-icon">‚öôÔ∏è</div>
            <div class="header-icon">üîî</div>
        </div>
    </div>
    
    <div class="container">
        <!-- Search Section (Initially visible) -->
        <div class="search-section" id="search-section">
            <h2 class="search-title">
                <span>üéØ</span> Analyze Wallet Exposure
            </h2>
            <p class="search-subtitle">Enter any Solana wallet to reveal its surveillance fingerprint</p>
            
            <div class="search-form">
                <div class="input-wrapper">
                    <input type="text" class="search-input" id="wallet-input" 
                           placeholder="Enter Solana wallet address...">
                    <div class="network-badge">
                        <svg width="18" height="18" viewBox="0 0 128 128" fill="none">
                            <circle cx="64" cy="64" r="64" fill="url(#sol-grad2)"/>
                            <defs>
                                <linearGradient id="sol-grad2" x1="0" y1="0" x2="128" y2="128">
                                    <stop stop-color="#9945FF"/>
                                    <stop offset="1" stop-color="#14F195"/>
                                </linearGradient>
                            </defs>
                        </svg>
                        Solana
                    </div>
                </div>
                <button class="search-btn" id="analyze-btn" onclick="analyzeWallet()">
                    <span>üî¨</span> Analyze
                </button>
            </div>
            
            <div class="slider-container">
                <span class="slider-label">üìä Transactions to analyze:</span>
                <div class="slider-wrapper">
                    <input type="range" class="limit-slider" id="limit-slider" 
                           min="50" max="500" step="50" value="200"
                           oninput="updateSliderValue(this.value)">
                    <div class="slider-value" id="slider-value">200 txns</div>
                </div>
            </div>
        </div>
        
        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loading-text">Initializing scan...</div>
            <div class="loading-steps" id="loading-steps">
                <div class="loading-step" data-step="1">‚óØ Fetching transactions</div>
                <div class="loading-step" data-step="2">‚óØ Analyzing patterns</div>
                <div class="loading-step" data-step="3">‚óØ Detecting behaviors</div>
                <div class="loading-step" data-step="4">‚óØ Querying external data</div>
                <div class="loading-step" data-step="5">‚óØ Compiling report</div>
            </div>
        </div>
        
        <!-- Main Dashboard Panel (Blueprint Style - 1:1 Match) -->
        <div id="dashboard" style="display: none;">
            <!-- Single Large Dashboard Container -->
            <div class="main-dashboard-panel" style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 24px; margin: 24px; box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);">
                <div class="dashboard-grid" style="display: grid; grid-template-columns: 320px 1fr 340px; grid-template-rows: auto auto; gap: 20px;">
                    <!-- Identity Linkage Panel (Top Left) -->
                    <div class="panel" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; padding: 18px; position: relative;">
                        <div class="panel-title" style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-muted); margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between; font-family: 'JetBrains Mono', monospace;">
                            IDENTITY LINKAGE
                            <span class="panel-badge" id="identity-confidence" style="font-size: 9px; padding: 3px 8px; background: rgba(0, 255, 136, 0.15); border: 1px solid rgba(0, 255, 136, 0.4); border-radius: 3px; color: var(--solana-green); font-weight: 700; font-family: 'JetBrains Mono', monospace;">98% CONFIDENCE</span>
                        </div>
                        <div class="profile-header" style="display: flex; align-items: center; gap: 14px; margin-bottom: 18px;">
                            <div class="profile-avatar" id="profile-avatar" style="width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #4a4a4a, #2a2a2a); display: flex; align-items: center; justify-content: center; font-size: 24px; border: 2px solid var(--border-color); flex-shrink: 0;">üë§</div>
                            <div class="profile-info" style="flex: 1;">
                                <h3 id="profile-handle" style="font-size: 17px; font-weight: 600; margin-bottom: 4px; font-family: 'Space Grotesk', sans-serif; color: var(--text-primary);">@cryptowhale_01</h3>
                                <div class="uid" id="profile-uid" style="font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-muted); letter-spacing: 0.05em;">UID: 8829-AF-221</div>
                            </div>
                        </div>
                        <div class="identity-links" id="identity-links" style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px;">
                            <!-- Populated by JS -->
                        </div>
                        <div class="intel-note" id="intel-note" style="padding: 10px 12px; background: rgba(255, 170, 0, 0.08); border-left: 3px solid var(--warning); border-radius: 4px; font-size: 10px; color: var(--warning); line-height: 1.6; font-family: 'JetBrains Mono', monospace;">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                
                    <!-- Network Clustering Panel (Top Middle) -->
                    <div class="panel network-panel" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; padding: 18px; position: relative; min-height: 450px;">
                        <div class="panel-title" style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-muted); margin-bottom: 16px; font-family: 'JetBrains Mono', monospace;">
                            NETWORK CLUSTERING V.4.8.2 // HEURISTIC MODE
                        </div>
                        <div class="network-canvas" id="network-canvas" style="width: 100%; height: 380px; position: relative; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; margin-top: 12px;">
                            <!-- Network graph rendered here -->
                        </div>
                        <div class="network-legend" style="display: flex; gap: 20px; margin-top: 16px; font-size: 9px; flex-wrap: wrap; font-family: 'JetBrains Mono', monospace;">
                            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
                                <div class="legend-dot" style="width: 10px; height: 10px; border-radius: 50%; border: 2px solid var(--yellow); background: rgba(255, 215, 0, 0.3); box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);"></div>
                                <span style="color: var(--text-secondary); font-weight: 600;">TARGET ENTITY</span>
                            </div>
                            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
                                <div class="legend-dot" style="width: 10px; height: 10px; border-radius: 50%; border: 2px solid var(--danger); background: rgba(255, 68, 68, 0.3);"></div>
                                <span style="color: var(--text-secondary); font-weight: 600;">HIGH RISK CONTRACT</span>
                            </div>
                            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
                                <div class="legend-dot" style="width: 10px; height: 10px; border-radius: 50%; border: 2px solid var(--border-color); background: var(--bg-tertiary);"></div>
                                <span style="color: var(--text-secondary); font-weight: 600;">STANDARD WALLET</span>
                            </div>
                        </div>
                        <div class="intel-note" id="network-intel-note" style="padding: 10px 12px; background: rgba(255, 170, 0, 0.08); border-left: 3px solid var(--warning); border-radius: 4px; font-size: 10px; color: var(--warning); line-height: 1.6; margin-top: 16px; font-family: 'JetBrains Mono', monospace;">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                
                    <!-- Financial Profiling Panel (Top Right) -->
                    <div class="panel financial-panel" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; padding: 18px; position: relative;">
                        <div class="panel-title" style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-muted); margin-bottom: 18px; font-family: 'JetBrains Mono', monospace;">
                            FINANCIAL PROFILING
                        </div>
                        <div style="margin-bottom: 16px;">
                            <div class="net-worth-label" style="font-size: 9px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 6px; font-family: 'JetBrains Mono', monospace;">NET WORTH ESTIMATE</div>
                            <div class="net-worth" id="net-worth" style="font-size: 28px; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--solana-green); margin-bottom: 4px;">$4,250,100.00</div>
                            <div class="net-worth-change" id="net-worth-change" style="font-size: 12px; color: var(--success); font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                <span>‚Üó</span> <span>+$240k (24h)</span>
                            </div>
                        </div>
                        <div style="margin-bottom: 18px;">
                            <div style="font-size: 9px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 10px; font-family: 'JetBrains Mono', monospace;">TOTAL PNL</div>
                            <div class="pnl-chart" id="pnl-chart" style="height: 90px; display: flex; align-items: flex-end; gap: 6px; background: var(--bg-primary); padding: 8px; border-radius: 4px; border: 1px solid var(--border-color);">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div class="fund-origins" style="display: flex; flex-direction: column; gap: 14px; margin-bottom: 16px;">
                            <div class="fund-item" style="display: flex; flex-direction: column;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span class="fund-label" style="font-size: 10px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; font-weight: 600;">DEFI PROTOCOLS</span>
                                    <span class="fund-value" id="defi-pct" style="font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 700; color: var(--text-primary);">62%</span>
                                </div>
                                <div class="fund-bar" style="width: 100%; height: 8px; background: var(--bg-primary); border-radius: 4px; overflow: hidden;">
                                    <div class="fund-bar-fill defi" id="defi-bar" style="height: 100%; border-radius: 4px; background: var(--solana-green); transition: width 0.5s; width: 62%;"></div>
                                </div>
                            </div>
                            <div class="fund-item" style="display: flex; flex-direction: column;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span class="fund-label" style="font-size: 10px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; font-weight: 600;">MIXERS (HIGH RISK)</span>
                                    <span class="fund-value" id="mixer-pct" style="font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 700; color: var(--danger);">28%</span>
                                </div>
                                <div class="fund-bar" style="width: 100%; height: 8px; background: var(--bg-primary); border-radius: 4px; overflow: hidden;">
                                    <div class="fund-bar-fill mixer" id="mixer-bar" style="height: 100%; border-radius: 4px; background: var(--danger); transition: width 0.5s; width: 28%;"></div>
                                </div>
                            </div>
                            <div class="fund-item" style="display: flex; flex-direction: column;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span class="fund-label" style="font-size: 10px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; font-weight: 600;">CEX WITHDRAWALS</span>
                                    <span class="fund-value" id="cex-pct" style="font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 700; color: var(--warning);">10%</span>
                                </div>
                                <div class="fund-bar" style="width: 100%; height: 8px; background: var(--bg-primary); border-radius: 4px; overflow: hidden;">
                                    <div class="fund-bar-fill cex" id="cex-bar" style="height: 100%; border-radius: 4px; background: var(--warning); transition: width 0.5s; width: 10%;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="intel-note" id="financial-intel-note" style="padding: 10px 12px; background: rgba(255, 170, 0, 0.08); border-left: 3px solid var(--warning); border-radius: 4px; font-size: 10px; color: var(--warning); line-height: 1.6; font-family: 'JetBrains Mono', monospace;">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                
                    <!-- Risk Score Panel (Bottom Left - Row 2) -->
                    <div class="panel risk-panel" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; padding: 18px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 14px; min-height: 220px; grid-column: 1;">
                        <div class="panel-title" style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-muted); width: 100%; text-align: left; font-family: 'JetBrains Mono', monospace;">RISK SCORE</div>
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 8px; flex: 1; justify-content: center;">
                            <div class="risk-score" id="risk-score" style="font-size: 72px; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--danger); line-height: 1;">92</div>
                            <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px;">
                                <span style="font-size: 32px; color: var(--danger);">‚ö†</span>
                                <div class="risk-level" id="risk-level" style="font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; color: var(--danger); font-family: 'JetBrains Mono', monospace;">CRITICAL THREAT LEVEL</div>
                            </div>
                        </div>
                        <div class="risk-bar" style="width: 100%; height: 10px; background: var(--bg-primary); border-radius: 5px; overflow: hidden; margin-top: 8px;">
                            <div class="risk-bar-fill" id="risk-bar-fill" style="height: 100%; background: linear-gradient(90deg, var(--danger), #ff6666); transition: width 0.5s; width: 92%;"></div>
                        </div>
                    </div>
                
                    <!-- Recent Activity Log Panel (Bottom Left - Row 2) -->
                    <div class="panel activity-panel" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; padding: 18px; position: relative; grid-column: 2; grid-row: 2;">
                        <div class="panel-title" style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-muted); margin-bottom: 16px; font-family: 'JetBrains Mono', monospace;">
                            RECENT ACTIVITY LOG
                        </div>
                        <div style="max-height: 350px; overflow-y: auto;">
                            <table class="activity-table" id="activity-table" style="width: 100%; font-size: 10px; margin-top: 12px; font-family: 'JetBrains Mono', monospace;">
                                <thead>
                                    <tr>
                                        <th style="text-align: left; padding: 10px 8px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; font-size: 9px; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color);">TIME (UTC)</th>
                                        <th style="text-align: left; padding: 10px 8px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; font-size: 9px; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color);">ACTION</th>
                                        <th style="text-align: left; padding: 10px 8px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; font-size: 9px; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color);">ASSET</th>
                                        <th style="text-align: left; padding: 10px 8px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; font-size: 9px; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color);">VALUE</th>
                                        <th style="text-align: left; padding: 10px 8px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; font-size: 9px; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color);">RISK</th>
                                    </tr>
                                </thead>
                                <tbody id="activity-tbody" style="color: var(--text-secondary);">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div class="view-full" style="text-align: center; margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--border-color);">
                            <button onclick="viewFullHistory()" style="background: none; border: none; color: var(--solana-green); text-decoration: none; font-size: 10px; font-weight: 700; cursor: pointer; font-family: 'JetBrains Mono', monospace; text-transform: uppercase; letter-spacing: 0.1em;">VIEW FULL HISTORY ‚Üí</button>
                        </div>
                    </div>
                
                    <!-- Behavioral Anomalies Panel (Bottom Right - Row 2) -->
                    <div class="panel behavioral-panel" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; padding: 18px; position: relative; grid-column: 3; grid-row: 2;">
                        <div class="panel-title" style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-muted); margin-bottom: 16px; font-family: 'JetBrains Mono', monospace;">
                            BEHAVIORAL ANOMALIES
                        </div>
                        <div class="behavior-item" style="padding: 14px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; margin-bottom: 14px;">
                            <div class="behavior-label" style="font-size: 9px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 10px; font-family: 'JetBrains Mono', monospace; font-weight: 700;">SLEEP SCHEDULE</div>
                            <div class="behavior-value" id="sleep-schedule" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px; font-family: 'Space Grotesk', sans-serif;">Irregular Pattern</div>
                            <div class="behavior-detail" id="sleep-detail" style="font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; line-height: 1.5;">Activity peaks between 02:00-06:00 UTC (85% of transactions)</div>
                        </div>
                        <div class="behavior-item" style="padding: 14px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; margin-bottom: 14px;">
                            <div class="behavior-label" style="font-size: 9px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 10px; font-family: 'JetBrains Mono', monospace; font-weight: 700;">BATCH TXNS</div>
                            <div class="behavior-value" id="batch-txns" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px; font-family: 'Space Grotesk', sans-serif;">42 Batches Detected</div>
                            <div class="behavior-detail" id="batch-detail" style="font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; line-height: 1.5;">Average batch size: 8.3 txns within 2-minute window</div>
                        </div>
                        <div class="behavior-item" style="padding: 14px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; margin-bottom: 14px;">
                            <div class="behavior-label" style="font-size: 9px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 10px; font-family: 'JetBrains Mono', monospace; font-weight: 700;">WALLET AGE</div>
                            <div class="behavior-value" id="wallet-age" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px; font-family: 'Space Grotesk', sans-serif;">2.4 Years</div>
                            <div class="behavior-detail" id="wallet-age-detail" style="font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; line-height: 1.5;">First transaction: 2021-11-15 (Pre-exploit wallet)</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Educational Section (All panels below main dashboard) -->
            <div class="educational-section" id="educational-section" style="margin: 24px; padding-top: 24px;">
                <!-- Educational panels will be populated here by JavaScript -->
            </div>
        </div>
        
        <!-- Results (Educational panels - legacy support) -->
        <div id="results">
            <!-- Exposure Header -->
            <div class="exposure-header">
                <div class="wallet-info">
                    <div class="wallet-label">Subject Wallet</div>
                    <div class="wallet-address">
                        <span id="display-address">-</span>
                        <button class="copy-btn" onclick="copyAddress()">üìã Copy</button>
                    </div>
                </div>
                
                <div class="score-section">
                    <div class="score-ring" id="score-ring">
                        <span class="score-value" id="score-value">-</span>
                        <span class="score-label">Exposure</span>
                    </div>
                    <div class="score-details">
                        <h2 id="score-title">Analyzing...</h2>
                        <p id="score-desc">Calculating your surveillance exposure based on on-chain activity.</p>
                    </div>
                </div>
            </div>
            
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value" id="stat-txns">-</div>
                    <div class="stat-label">Transactions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ü§ñ</div>
                    <div class="stat-value" id="stat-bot">-</div>
                    <div class="stat-label">Bot Probability</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üåç</div>
                    <div class="stat-value" id="stat-region">-</div>
                    <div class="stat-label">Likely Region</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-value" id="stat-speed">-</div>
                    <div class="stat-label">Avg Reaction</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="icon">üß≠</span>
                            Exposure Snapshot
                        </div>
                        <span class="card-badge" id="confidence-badge">-</span>
                    </div>
                    <div class="snapshot-grid" id="snapshot-grid"></div>
                    <div class="meta-row" id="meta-row"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="icon">üßæ</span>
                            Identity Leak Surface
                        </div>
                    </div>
                    <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">
                        Public posts, profiles, and name services can link a wallet to a real identity.
                        Check the most common public surfaces below:
                    </p>
                    <div class="link-grid">
                        <a href="#" id="link-x-search" target="_blank" class="link-tile">
                            <span class="icon">ùïè</span>
                            <div>
                                <div class="label">X Search</div>
                                <div class="desc">Public mentions of your address</div>
                            </div>
                        </a>
                        <a href="#" id="link-sns-search" target="_blank" class="link-tile">
                            <span class="icon">ü™™</span>
                            <div>
                                <div class="label">SNS Reverse Lookup</div>
                                <div class="desc">Solana name service links</div>
                            </div>
                        </a>
                        <a href="#" id="link-solanafm" target="_blank" class="link-tile">
                            <span class="icon">üõ∞Ô∏è</span>
                            <div>
                                <div class="label">SolanaFM</div>
                                <div class="desc">Alternative explorer metadata</div>
                            </div>
                        </a>
                        <a href="#" id="link-0xppl" target="_blank" class="link-tile">
                            <span class="icon">üß†</span>
                            <div>
                                <div class="label">0xPPL</div>
                                <div class="desc">Public intelligence tooling</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- EDUCATIONAL SECTION: How You're Being Watched -->
            <div class="card" style="border-color: var(--danger); background: linear-gradient(135deg, rgba(239,68,68,0.05), transparent);">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üö®</span>
                        How Mass Financial Surveillance Works
                    </div>
                </div>
                <p style="color: var(--text-secondary); font-size: 15px; line-height: 1.7; margin-bottom: 20px;">
                    Every blockchain transaction is <strong style="color: var(--danger);">permanently public</strong>. 
                    Governments, analytics firms, and exchanges use sophisticated techniques to link your wallet 
                    to your real identity. Here's exactly how they do it with <em>your</em> data:
                </p>
                <div class="knowledge-grid" id="knowledge-grid"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üß™</span>
                        Exposure Breakdown
                    </div>
                    <span class="card-badge" id="score-badge">-</span>
                </div>
                <div class="breakdown-list" id="exposure-breakdown"></div>
                <p style="color: var(--text-muted); font-size: 12px; margin-top: 14px;">
                    This breakdown explains which on-chain behaviors contribute most to your score.
                </p>
            </div>
            
            <!-- EDUCATIONAL SECTION: Temporal Fingerprinting -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üïê</span>
                        Temporal Fingerprinting: Your Timezone is Exposed
                    </div>
                    <span class="card-badge" id="tz-badge" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">-</span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <h4 style="color: var(--warning); font-size: 14px; margin-bottom: 12px;">üìö How This Attack Works</h4>
                        <p style="color: var(--text-muted); font-size: 13px; line-height: 1.7; margin-bottom: 16px;">
                            Humans sleep. By analyzing <strong>when you DON'T transact</strong>, surveillance entities 
                            can determine your timezone with high accuracy. A 6-hour gap at 2-8 AM UTC suggests Europe. 
                            A gap at 8-14 UTC suggests East Asia. Your sleep schedule is a fingerprint.
                        </p>
                        <div style="background: var(--bg-primary); border-radius: 12px; padding: 16px;">
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">YOUR DETECTED SLEEP WINDOW</div>
                            <div id="sleep-display" style="font-family: 'JetBrains Mono', monospace; font-size: 18px; color: var(--warning);">Analyzing...</div>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">üìä Your Activity by Hour (UTC)</h4>
                        <div class="heatmap-container">
                            <div class="heatmap" id="heatmap"></div>
                            <div class="heatmap-labels" id="heatmap-labels"></div>
                        </div>
                        <p style="color: var(--text-muted); font-size: 11px; margin-top: 12px; text-align: center;">
                            Red = high activity. Dark = low activity (sleep hours)
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- EDUCATIONAL SECTION: Behavioral Fingerprinting -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">ü§ñ</span>
                        Behavioral Fingerprinting: Bot or Human?
                    </div>
                    <span class="card-badge" id="bot-badge">-</span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <h4 style="color: var(--info); font-size: 14px; margin-bottom: 12px;">üìö How This Attack Works</h4>
                        <p style="color: var(--text-muted); font-size: 13px; line-height: 1.7; margin-bottom: 16px;">
                            When you receive tokens, how fast do you react? Bots respond in <strong>&lt;5 seconds</strong>. 
                            Humans take 30+ seconds to notice, decide, and act. This single metric can classify you 
                            with 70%+ accuracy ‚Äî and bots face extra scrutiny from regulators.
                        </p>
                        <div style="background: var(--bg-primary); border-radius: 12px; padding: 16px;">
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">YOUR REACTION PROFILE</div>
                            <div id="reaction-display" style="font-family: 'JetBrains Mono', monospace;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: var(--text-muted);">Instant (&lt;5s):</span>
                                    <span id="instant-count" style="color: var(--danger);">-</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: var(--text-muted);">Fast (5-30s):</span>
                                    <span id="fast-count" style="color: var(--warning);">-</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-muted);">Human (&gt;30s):</span>
                                    <span id="human-count" style="color: var(--success);">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">üìä Profile Classification</h4>
                        <p style="color: var(--text-muted); font-size: 12px; margin-bottom: 16px;">
                            Based on your behavior, here's how analytics firms would categorize you:
                        </p>
                        <div id="profile-bars"></div>
                    </div>
                </div>
            </div>
            
            <!-- EDUCATIONAL SECTION: Protocol Fingerprinting -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üîß</span>
                        Protocol Fingerprinting: Your App Usage
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <h4 style="color: var(--solana-purple); font-size: 14px; margin-bottom: 12px;">üìö How This Attack Works</h4>
                        <p style="color: var(--text-muted); font-size: 13px; line-height: 1.7; margin-bottom: 16px;">
                            The combination of apps you use creates a <strong>quasi-identifier</strong>. 
                            Only ~0.1% of users might use Jupiter + Jito + Tensor + a specific token. 
                            Combined with timezone, you become uniquely identifiable even without direct links.
                        </p>
                        <div style="background: var(--bg-primary); border-radius: 12px; padding: 16px;">
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;">DETECTED PROTOCOLS</div>
                            <div class="protocol-grid" id="protocols"></div>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">ü™ê Your DeFi Positions (via Jupiter)</h4>
                        <p style="color: var(--text-muted); font-size: 12px; margin-bottom: 16px;">
                            Your token holdings reveal wealth level, risk appetite, and trading preferences:
                        </p>
                        <div class="token-list" id="portfolio"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üí∞</span>
                        Financial Surveillance Signals
                    </div>
                </div>
                <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">
                    Holdings reveal net worth, risk appetite, and trading style. These signals are derived from
                    public portfolio data and are visible to anyone.
                </p>
                <div id="portfolio-insights"></div>
            </div>
            
            <!-- EDUCATIONAL SECTION: Graph Analysis & Arkham -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üïµÔ∏è</span>
                        Graph Analysis: How Arkham Intelligence Tracks You
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <h4 style="color: #a78bfa; font-size: 14px; margin-bottom: 12px;">üìö How This Attack Works</h4>
                        <p style="color: var(--text-muted); font-size: 13px; line-height: 1.7; margin-bottom: 16px;">
                            <strong>Arkham Intelligence</strong> and similar firms build massive graph databases 
                            linking wallets through shared counterparties, funding sources, and timing patterns. 
                            Even "anonymous" wallets get clustered and labeled. If ONE wallet in your cluster 
                            is ever KYC'd, the entire cluster is identified.
                        </p>
                        <div class="arkham-box">
                            <div class="arkham-title">üè∑Ô∏è How They'd Label You</div>
                            <div class="entity-tags" id="arkham-labels"></div>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">üîó What's Publicly Known</h4>
                        <p style="color: var(--text-muted); font-size: 12px; margin-bottom: 16px;">
                            These companies have real-time access to your on-chain activity:
                        </p>
                        <div style="display: flex; flex-direction: column; gap: 10px;" id="arkham-links">
                            <a href="#" id="link-arkham-2" target="_blank" style="display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--bg-primary); border-radius: 10px; text-decoration: none; transition: all 0.2s;">
                                <span style="font-size: 24px;">üïµÔ∏è</span>
                                <div>
                                    <div style="color: var(--text-primary); font-weight: 600;">Arkham Intelligence</div>
                                    <div style="color: var(--text-muted); font-size: 12px;">View your full dossier ‚Üí</div>
                                </div>
                            </a>
                            <a href="#" id="link-solscan-2" target="_blank" style="display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--bg-primary); border-radius: 10px; text-decoration: none; transition: all 0.2s;">
                                <span style="font-size: 24px;">üîç</span>
                                <div>
                                    <div style="color: var(--text-primary); font-weight: 600;">Solscan</div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Public transaction history ‚Üí</div>
                                </div>
                            </a>
                            <a href="#" id="link-jup-2" target="_blank" style="display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--bg-primary); border-radius: 10px; text-decoration: none; transition: all 0.2s;">
                                <span style="font-size: 24px;">ü™ê</span>
                                <div>
                                    <div style="color: var(--text-primary); font-weight: 600;">Jupiter Portfolio</div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Your complete holdings ‚Üí</div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Surveillance Vectors Summary -->
            <div class="card" style="border-color: var(--danger);">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üéØ</span>
                        Active Surveillance Vectors on YOUR Wallet
                    </div>
                    <span class="card-badge" id="vectors-badge">0 Active</span>
                </div>
                <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 20px;">
                    These are the specific techniques that can be used to track, profile, and identify you:
                </p>
                <div class="vector-list" id="vectors-list"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">‚õìÔ∏è</span>
                        Privacy Mistakes That Re-Link You
                    </div>
                </div>
                <div class="risk-list" id="mistake-list"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üß©</span>
                        Selective Privacy Playbook
                    </div>
                </div>
                <div class="playbook-list">
                    <div class="playbook-item">
                        <h4>1) Break the on-chain link</h4>
                        <p>Move funds through a privacy-preserving tool so your new wallet is not graph-linked.</p>
                    </div>
                    <div class="playbook-item">
                        <h4>2) Add time & amount randomness</h4>
                        <p>Delay transfers and avoid identical amounts to reduce timing and amount fingerprinting.</p>
                    </div>
                    <div class="playbook-item">
                        <h4>3) Split roles per wallet</h4>
                        <p>Separate public identity, trading, and long-term storage to avoid clustering.</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üîê</span>
                        Protect Your Wallet with encrypt.trade
                    </div>
                </div>
                <div class="protect-banner">
                    <h4>Selective privacy that keeps usability intact</h4>
                    <p style="color: var(--text-secondary); font-size: 13px;">
                        encrypt.trade helps you break the on-chain link while still using familiar wallets and apps.
                        It is built to reduce surveillance exposure without forcing you to abandon usability.
                    </p>
                    <div class="protect-steps">
                        <div class="protect-step">
                            <strong>Step 1: Create a clean destination</strong>
                            <p>Generate a fresh wallet and keep it separate from public identity.</p>
                        </div>
                        <div class="protect-step">
                            <strong>Step 2: Break the link</strong>
                            <p>Use encrypt.trade to move funds privately so graph clustering is disrupted.</p>
                        </div>
                        <div class="protect-step">
                            <strong>Step 3: Rebuild safely</strong>
                            <p>Add time gaps, vary amounts, and avoid reuse to prevent re-linking.</p>
                        </div>
                    </div>
                    <a href="https://encrypt.trade" target="_blank" class="cta-btn" style="align-self: flex-start;">
                        üîê Start with encrypt.trade
                    </a>
                </div>
            </div>
            
            <!-- CTA -->
            <div class="cta-section">
                <div class="cta-icon">üõ°Ô∏è</div>
                <h3>Break the Surveillance Chain</h3>
                <p>
                    Creating a new wallet doesn't erase your fingerprint. Past activity, timing patterns, 
                    and counterparty connections remain permanently linkable. True privacy requires 
                    breaking the on-chain link.
                </p>
                <a href="https://encrypt.trade" target="_blank" class="cta-btn">
                    üîê Visit encrypt.trade
                </a>

                <div class="cta-tiles">
                    <a href="https://encrypt.trade" target="_blank" class="cta-tile primary">
                        <strong>Break the Link</strong>
                        Use encrypt.trade to create a clean wallet without traceable links.
                    </a>
                    <a href="https://jup.ag" target="_blank" class="cta-tile">
                        <strong>Start Fresh</strong>
                        Create a new wallet and fund it cautiously with low linkage.
                    </a>
                    <a href="https://lightprotocol.xyz" target="_blank" class="cta-tile">
                        <strong>Privacy Tools</strong>
                        Explore privacy primitives for transfers and app usage.
                    </a>
                </div>
                
                <div class="external-links">
                    <a href="#" id="link-solscan" target="_blank" class="ext-link">
                        üîç View on Solscan
                    </a>
                    <a href="#" id="link-arkham" target="_blank" class="ext-link">
                        üïµÔ∏è View on Arkham
                    </a>
                    <a href="#" id="link-jupiter" target="_blank" class="ext-link">
                        ü™ê Jupiter Portfolio
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>
                <strong>LeakLens</strong> ‚Äî Built for the <a href="https://encrypt.trade" target="_blank">encrypt.trade</a> hackathon
            </p>
            <p style="margin-top: 8px;">
                Track 1: Educate users about mass financial surveillance
            </p>
        </footer>
    </div>
    
    <script>
        // State
        let currentData = null;
        let currentWallet = null;
        let currentPortfolio = null;
        let currentPortfolioSummary = null;
        let currentPortfolioStatus = 'idle';
        
        // Analyze wallet
        function updateSliderValue(val) {
            document.getElementById('slider-value').textContent = val + ' txns';
        }
        
        async function analyzeWallet() {
            const wallet = document.getElementById('wallet-input').value.trim();
            const limit = parseInt(document.getElementById('limit-slider').value);
            
            if (!wallet) {
                alert('Please enter a wallet address');
                return;
            }
            
            // Validate Solana address (base58, 32-44 chars)
            if (!/^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(wallet)) {
                alert('Please enter a valid Solana wallet address');
                return;
            }
            
            currentWallet = wallet;
            
            // Show loading
            const loading = document.getElementById('loading');
            loading.classList.add('active');
            
            // Animate loading steps
            const steps = document.querySelectorAll('.loading-step');
            let stepIndex = 0;
            const stepInterval = setInterval(() => {
                if (stepIndex > 0) {
                    steps[stepIndex - 1].classList.remove('active');
                    steps[stepIndex - 1].classList.add('done');
                    steps[stepIndex - 1].textContent = '‚úì ' + steps[stepIndex - 1].textContent.slice(2);
                }
                if (stepIndex < steps.length) {
                    steps[stepIndex].classList.add('active');
                    steps[stepIndex].textContent = '‚óè ' + steps[stepIndex].textContent.slice(2);
                    stepIndex++;
                }
            }, 600);
            
            try {
                // Fetch analysis
                const response = await fetch('/analyze-wallet', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ wallet: wallet, limit: limit, chain: 'solana' })
                });
                
                const data = await response.json();
                
                if (data.error || data.detail) {
                    throw new Error(data.error || data.detail);
                }
                
                currentData = data;
                
                // Fetch Jupiter portfolio (non-blocking, handles CORS gracefully)
                fetchJupiterPortfolio(wallet).catch(err => {
                    // Silently handle CORS or other fetch errors
                    console.log('Portfolio fetch skipped:', err.message);
                });
                
                // Display results
                displayResults(data);
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error: ' + error.message);
            } finally {
                clearInterval(stepInterval);
                loading.classList.remove('active');
                // Reset steps
                steps.forEach(s => {
                    s.classList.remove('active', 'done');
                    s.textContent = '‚óØ ' + s.textContent.slice(2);
                });
            }
        }
        
        // Display results
        function displayResults(data) {
            // Update header
            const shortAddr = currentWallet.slice(0, 6) + '...' + currentWallet.slice(-4);
            document.getElementById('header-address').textContent = '0x' + shortAddr;
            document.getElementById('status-badge').style.display = 'inline-flex';
            
            // Show dashboard, hide search
            document.getElementById('search-section').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Populate dashboard panels
            updateDashboardPanels(data);
            
            // First, populate the hidden results section with all the old display functions
            // This ensures all educational content is created
            document.getElementById('results').classList.add('active');
            document.getElementById('display-address').textContent = shortAddr;
            
            // Call all the old display functions to populate results section
            const score = calculateScore(data);
            displayScore(score, data);
            displaySnapshot(data, score);
            displayBreakdown(data, score);
            
            // Stats
            document.getElementById('stat-txns').textContent = data.total_transactions || 0;
            document.getElementById('stat-bot').textContent = (data.reaction_speed?.bot_confidence || 0).toFixed(0) + '%';
            document.getElementById('stat-speed').textContent = (data.reaction_speed?.avg_reaction_time || 0).toFixed(1) + 's';
            
            const geo = data.geographic_origin || {};
            const regions = [
                { name: 'Asia', pct: geo.asia_pacific || 0 },
                { name: 'Europe', pct: geo.europe || 0 },
                { name: 'Americas', pct: geo.americas || 0 }
            ].sort((a, b) => b.pct - a.pct);
            document.getElementById('stat-region').textContent = regions[0].pct > 40 ? regions[0].name : 'Unknown';
            
            // Populate all educational content
            displayKnowledge(data);
            displayVectors(data);
            displayHeatmap(data);
            displayProfile(data);
            displayProtocols(data);
            displayArkham(data);
            displayPortfolioInsights();
            displayPrivacyMistakes(data);
            
            // Sleep window display
            if (data.sleep_window?.confidence > 30) {
                const s = String(data.sleep_window.start_hour).padStart(2, '0');
                const e = String(data.sleep_window.end_hour).padStart(2, '0');
                document.getElementById('sleep-display').innerHTML = `
                    ${s}:00 - ${e}:00 UTC<br>
                    <span style="font-size: 13px; color: var(--text-muted);">${data.sleep_window.confidence.toFixed(0)}% confidence</span>
                `;
            } else {
                document.getElementById('sleep-display').innerHTML = `
                    No clear pattern<br>
                    <span style="font-size: 13px; color: var(--text-muted);">Possibly a bot or VPN user</span>
                `;
            }
            
            // Reaction stats
            document.getElementById('instant-count').textContent = data.reaction_speed?.instant_reactions || 0;
            document.getElementById('fast-count').textContent = data.reaction_speed?.fast_reactions || 0;
            document.getElementById('human-count').textContent = data.reaction_speed?.human_reactions || 0;
            
            const botConf = data.reaction_speed?.bot_confidence || 0;
            document.getElementById('bot-badge').textContent = botConf > 60 ? 'Likely Bot' : botConf > 30 ? 'Mixed Signals' : 'Likely Human';
            
            // Update external links
            document.getElementById('link-solscan').href = `https://solscan.io/account/${currentWallet}`;
            document.getElementById('link-arkham').href = `https://platform.arkhamintelligence.com/explorer/address/${currentWallet}`;
            document.getElementById('link-jupiter').href = `https://jup.ag/portfolio/${currentWallet}`;
            displayIdentityLinks();
            
            // Now move educational content to dashboard
            const educationalSection = document.getElementById('educational-section');
            const resultsSection = document.getElementById('results');
            if (resultsSection && educationalSection) {
                // Clear existing
                educationalSection.innerHTML = '';
                // Clone all cards from results section (excluding exposure header and stats)
                const cards = resultsSection.querySelectorAll('.card, .cta-section');
                cards.forEach(card => {
                    const clonedCard = card.cloneNode(true);
                    educationalSection.appendChild(clonedCard);
                });
            }
            
            // Hide old results section, show dashboard
            document.getElementById('results').style.display = 'none';
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Update dashboard panels
        function updateDashboardPanels(data) {
            // Update Identity Panel
            updateIdentityPanel(data);
            
            // Update Network Panel
            updateNetworkPanel(data);
            
            // Update Financial Panel
            updateFinancialPanel(data);
            
            // Update Risk Score
            updateRiskScore(data);
            
            // Update Activity Log
            updateActivityLog(data);
            
            // Update Behavioral Anomalies
            updateBehavioralAnomalies(data);
        }
        
        // Update identity panel
        function updateIdentityPanel(data) {
            // Hardcoded placeholder data (as per user request)
            document.getElementById('profile-handle').textContent = '@wallet_' + currentWallet.slice(0, 6);
            document.getElementById('profile-uid').textContent = 'UID: ' + currentWallet.slice(0, 8).toUpperCase() + '-' + currentWallet.slice(8, 10).toUpperCase() + '-' + currentWallet.slice(10, 13);
            document.getElementById('identity-confidence').textContent = '75% CONFIDENCE';
            
            const botConf = data.reaction_speed?.bot_confidence || 0;
            const tags = [];
            if (botConf > 60) {
                tags.push('SUSPECTED DEV');
                document.getElementById('tag-badge').style.display = 'inline-flex';
            }
            if (data.profile_classification?.whale > 50) tags.push('HIGH VALUE');
            
            if (tags.length > 0) {
                document.getElementById('tag-badge').textContent = tags[0];
            }
            
            const geo = data.geographic_origin || {};
            const regions = [
                { name: 'Asia', pct: geo.asia_pacific || 0 },
                { name: 'Europe', pct: geo.europe || 0 },
                { name: 'Americas', pct: geo.americas || 0 }
            ].sort((a, b) => b.pct - a.pct);
            
            const likelyRegion = regions[0].pct > 40 ? regions[0].name : 'Unknown';
            
            let locationInfo = 'Unknown';
            if (likelyRegion === 'Asia') locationInfo = 'Tokyo, JP';
            else if (likelyRegion === 'Europe') locationInfo = 'Zurich, CH';
            else if (likelyRegion === 'Americas') locationInfo = 'New York, US';
            
            const lastActive = data.most_recent_transaction ? 'Just Now' : 'Unknown';
            
            // Use blueprint values exactly
            const handle = '@cryptowhale_01';
            const discordHandle = `cw_01#9921`;
            
            document.getElementById('profile-handle').textContent = handle;
            document.getElementById('profile-uid').textContent = 'UID: 8829-AF-221';
            document.getElementById('identity-confidence').textContent = '98% CONFIDENCE';
            
            document.getElementById('identity-links').innerHTML = `
                <div class="identity-link" style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px;">
                    <span style="font-size: 10px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; font-weight: 600;">Twitter/X</span>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <span style="font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-primary);">${handle}</span>
                        <span style="font-size: 9px; padding: 2px 6px; background: rgba(0, 255, 136, 0.15); border: 1px solid rgba(0, 255, 136, 0.4); border-radius: 3px; color: var(--solana-green); font-weight: 700; font-family: 'JetBrains Mono', monospace;">VERIFIED</span>
                    </div>
                </div>
                <div class="identity-link" style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px;">
                    <span style="font-size: 10px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; font-weight: 600;">Discord</span>
                    <span style="font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-primary);">${discordHandle}</span>
                </div>
                <div class="identity-link" style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px;">
                    <span style="font-size: 10px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; font-weight: 600;">ProtonMail</span>
                    <span style="font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-secondary); filter: blur(4px); letter-spacing: 0.1em; user-select: none;">crypto‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢@protonmail.com</span>
                </div>
                <div class="identity-link" style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px;">
                    <span style="font-size: 10px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; font-weight: 600;">IP GEO</span>
                    <span style="font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-primary);">Zurich, CH</span>
                </div>
                <div class="identity-link" style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px;">
                    <span style="font-size: 10px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; font-weight: 600;">LAST ACTIVE</span>
                    <span style="font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-primary);">Just Now</span>
                </div>
            `;
            
            document.getElementById('intel-note').textContent = 
                'Cross-referenced via leaked database ID-44. Email pattern matches known dev wallet signatures.';
        }
        
        // Update network panel
        function updateNetworkPanel(data) {
            const canvas = document.getElementById('network-canvas');
            canvas.innerHTML = ''; // Clear existing
            
            const centerX = canvas.offsetWidth / 2;
            const centerY = canvas.offsetHeight / 2;
            
            // Create connected nodes first (so lines are behind)
            const nodes = [
                { label: 'TORNADO CASH', type: 'high-risk', angle: 45, offset: 130 },
                { label: 'Binance Deposit', type: 'standard', angle: 135, offset: 130 },
                { label: 'Uniswap V3', type: 'standard', angle: 225, offset: 130 },
                { label: 'Unknown Wallet', type: 'standard', angle: 315, offset: 130 }
            ];
            
            // Draw connection lines first
            nodes.forEach(node => {
                const line = document.createElement('div');
                line.style.position = 'absolute';
                line.style.left = centerX + 'px';
                line.style.top = centerY + 'px';
                line.style.width = node.offset + 'px';
                line.style.height = '2px';
                line.style.transformOrigin = '0 0';
                line.style.transform = `rotate(${node.angle}deg)`;
                line.style.borderTop = '2px dashed rgba(255,255,255,0.25)';
                line.style.zIndex = '1';
                canvas.appendChild(line);
            });
            
            // Create target node (center) - YELLOW GLOWING
            const targetNode = document.createElement('div');
            targetNode.style.position = 'absolute';
            targetNode.style.left = (centerX - 25) + 'px';
            targetNode.style.top = (centerY - 25) + 'px';
            targetNode.style.width = '50px';
            targetNode.style.height = '50px';
            targetNode.style.borderRadius = '50%';
            targetNode.style.background = 'rgba(255, 215, 0, 0.3)';
            targetNode.style.border = '3px solid var(--yellow)';
            targetNode.style.display = 'flex';
            targetNode.style.alignItems = 'center';
            targetNode.style.justifyContent = 'center';
            targetNode.style.fontSize = '24px';
            targetNode.style.fontWeight = '700';
            targetNode.textContent = '‚óè';
            targetNode.style.color = 'var(--yellow)';
            targetNode.title = 'Target Entity';
            targetNode.style.boxShadow = '0 0 30px rgba(255, 215, 0, 0.8), inset 0 0 20px rgba(255, 215, 0, 0.3)';
            targetNode.style.zIndex = '10';
            canvas.appendChild(targetNode);
            
            // Create label for target node
            const targetLabel = document.createElement('div');
            targetLabel.textContent = 'Target Entity';
            targetLabel.style.position = 'absolute';
            targetLabel.style.left = (centerX - 35) + 'px';
            targetLabel.style.top = (centerY + 35) + 'px';
            targetLabel.style.fontSize = '9px';
            targetLabel.style.fontFamily = "'JetBrains Mono', monospace";
            targetLabel.style.color = 'var(--text-secondary)';
            targetLabel.style.fontWeight = '600';
            targetLabel.style.whiteSpace = 'nowrap';
            targetLabel.style.zIndex = '10';
            canvas.appendChild(targetLabel);
            
            // Create connected nodes
            nodes.forEach(node => {
                const x = centerX + Math.cos(node.angle * Math.PI / 180) * node.offset - 20;
                const y = centerY + Math.sin(node.angle * Math.PI / 180) * node.offset - 20;
                
                const nodeEl = document.createElement('div');
                nodeEl.style.position = 'absolute';
                nodeEl.style.left = x + 'px';
                nodeEl.style.top = y + 'px';
                nodeEl.style.width = '40px';
                nodeEl.style.height = '40px';
                nodeEl.style.borderRadius = '50%';
                nodeEl.style.border = '2px solid';
                nodeEl.style.display = 'flex';
                nodeEl.style.alignItems = 'center';
                nodeEl.style.justifyContent = 'center';
                nodeEl.style.fontSize = '18px';
                nodeEl.style.fontWeight = '600';
                nodeEl.style.cursor = 'pointer';
                nodeEl.style.zIndex = '5';
                
                if (node.type === 'high-risk') {
                    nodeEl.style.background = 'rgba(255, 68, 68, 0.3)';
                    nodeEl.style.borderColor = 'var(--danger)';
                    nodeEl.style.color = 'var(--danger)';
                } else {
                    nodeEl.style.background = 'var(--bg-tertiary)';
                    nodeEl.style.borderColor = 'var(--border-color)';
                    nodeEl.style.color = 'var(--text-secondary)';
                }
                
                nodeEl.textContent = '‚óè';
                nodeEl.title = node.label;
                
                // Add label
                const labelEl = document.createElement('div');
                labelEl.textContent = node.label;
                labelEl.style.position = 'absolute';
                labelEl.style.left = '50%';
                labelEl.style.transform = 'translateX(-50%)';
                labelEl.style.top = (node.angle > 90 && node.angle < 270) ? '-30px' : '50px';
                labelEl.style.fontSize = '9px';
                labelEl.style.fontFamily = "'JetBrains Mono', monospace";
                labelEl.style.color = 'var(--text-secondary)';
                labelEl.style.fontWeight = '600';
                labelEl.style.whiteSpace = 'nowrap';
                labelEl.style.textAlign = 'center';
                labelEl.style.zIndex = '5';
                nodeEl.appendChild(labelEl);
                
                // Add subtitle for high-risk
                if (node.type === 'high-risk') {
                    const subLabelEl = document.createElement('div');
                    subLabelEl.textContent = 'High Risk Contract';
                    subLabelEl.style.position = 'absolute';
                    subLabelEl.style.left = '50%';
                    subLabelEl.style.transform = 'translateX(-50%)';
                    subLabelEl.style.top = (node.angle > 90 && node.angle < 270) ? '-18px' : '62px';
                    subLabelEl.style.fontSize = '8px';
                    subLabelEl.style.fontFamily = "'JetBrains Mono', monospace";
                    subLabelEl.style.color = 'var(--text-muted)';
                    subLabelEl.style.fontWeight = '400';
                    subLabelEl.style.whiteSpace = 'nowrap';
                    nodeEl.appendChild(subLabelEl);
                } else {
                    const subLabelEl = document.createElement('div');
                    subLabelEl.textContent = 'Standard Wallet';
                    subLabelEl.style.position = 'absolute';
                    subLabelEl.style.left = '50%';
                    subLabelEl.style.transform = 'translateX(-50%)';
                    subLabelEl.style.top = (node.angle > 90 && node.angle < 270) ? '-18px' : '62px';
                    subLabelEl.style.fontSize = '8px';
                    subLabelEl.style.fontFamily = "'JetBrains Mono', monospace";
                    subLabelEl.style.color = 'var(--text-muted)';
                    subLabelEl.style.fontWeight = '400';
                    subLabelEl.style.whiteSpace = 'nowrap';
                    nodeEl.appendChild(subLabelEl);
                }
                
                canvas.appendChild(nodeEl);
            });
            
            document.getElementById('network-intel-note').textContent = 
                '4 hops detected via Tornado Cash heuristic. Clustering algorithm indicates 95% probability of funds originating from exploit #882.';
        }
        
        // Update financial panel
        function updateFinancialPanel(data) {
            // Use blueprint values
            const estimatedValue = 4250100;
            const change24h = 240000;
            
            document.getElementById('net-worth').textContent = '$4,250,100.00';
            document.getElementById('net-worth-change').innerHTML = '<span>‚Üó</span> <span>+$240k (24h)</span>';
            
            // Generate PNL bars matching blueprint - golden bar on far right with +1280% label
            const pnlChart = document.getElementById('pnl-chart');
            pnlChart.innerHTML = '';
            const barHeights = [25, 30, 35, 40, 45, 38, 42, 35, 50, 55, 65, 85]; // Last one is tallest (golden)
            
            for (let i = 0; i < 12; i++) {
                const barContainer = document.createElement('div');
                barContainer.style.position = 'relative';
                barContainer.style.flex = '1';
                barContainer.style.display = 'flex';
                barContainer.style.flexDirection = 'column';
                barContainer.style.alignItems = 'center';
                barContainer.style.gap = '4px';
                
                const bar = document.createElement('div');
                bar.style.width = '100%';
                bar.style.height = barHeights[i] + '%';
                if (i === 11) {
                    // Golden bar on the right
                    bar.style.background = 'linear-gradient(180deg, #ffd700, #ffaa00)';
                    bar.style.boxShadow = '0 0 10px rgba(255, 215, 0, 0.5)';
                } else {
                    bar.style.background = 'var(--bg-tertiary)';
                    bar.style.border = '1px solid var(--border-color)';
                }
                bar.style.borderRadius = '3px 3px 0 0';
                bar.style.transition = 'all 0.3s';
                bar.style.minHeight = '12px';
                
                barContainer.appendChild(bar);
                
                // Add label for golden bar
                if (i === 11) {
                    const label = document.createElement('div');
                    label.textContent = '+1280%';
                    label.style.fontSize = '8px';
                    label.style.fontFamily = "'JetBrains Mono', monospace";
                    label.style.color = 'var(--yellow)';
                    label.style.fontWeight = '700';
                    label.style.position = 'absolute';
                    label.style.bottom = '-16px';
                    label.style.whiteSpace = 'nowrap';
                    barContainer.appendChild(label);
                }
                
                pnlChart.appendChild(barContainer);
            }
            
            // Fund origins matching blueprint
            const defiPct = 62;
            const mixerPct = 28;
            const cexPct = 10;
            
            document.getElementById('defi-pct').textContent = defiPct + '%';
            document.getElementById('mixer-pct').textContent = mixerPct + '%';
            document.getElementById('cex-pct').textContent = cexPct + '%';
            
            setTimeout(() => {
                document.getElementById('defi-bar').style.width = defiPct + '%';
                document.getElementById('mixer-bar').style.width = mixerPct + '%';
                document.getElementById('cex-bar').style.width = cexPct + '%';
            }, 100);
            
            document.getElementById('financial-intel-note').textContent = 
                'On-chain volume suggests insider trading patterns. Look for pre-announcement accumulation.';
        }
        
        // Update risk score panel
        function updateRiskScore(data) {
            // Use blueprint value for exact match
            const riskScore = 92;
            
            document.getElementById('risk-score').textContent = riskScore;
            document.getElementById('risk-level').textContent = 'CRITICAL THREAT LEVEL';
            
            setTimeout(() => {
                document.getElementById('risk-bar-fill').style.width = riskScore + '%';
            }, 100);
        }
        
        // Update activity log panel
        function updateActivityLog(data) {
            const tbody = document.getElementById('activity-tbody');
            tbody.innerHTML = '';
            
            const transactions = data.recent_transactions || [];
            const sampleTransactions = [
                { time: '14:32:15', action: 'SWAP', asset: 'SOL ‚Üí USDC', value: '$42,500', risk: 'HIGH' },
                { time: '14:28:42', action: 'TRANSFER', asset: 'USDC', value: '$125,000', risk: 'MED' },
                { time: '14:15:03', action: 'SWAP', asset: 'ETH ‚Üí SOL', value: '$8,900', risk: 'LOW' },
                { time: '13:58:21', action: 'DEPOSIT', asset: 'SOL', value: '$250,000', risk: 'CRITICAL' },
                { time: '13:42:11', action: 'SWAP', asset: 'BTC ‚Üí USDC', value: '$15,200', risk: 'MED' }
            ];
            
            sampleTransactions.forEach((tx, idx) => {
                const row = document.createElement('tr');
                row.style.borderBottom = idx < sampleTransactions.length - 1 ? '1px solid var(--border-color)' : 'none';
                
                const riskColor = tx.risk === 'CRITICAL' ? 'var(--danger)' : 
                                 tx.risk === 'HIGH' ? 'var(--warning)' : 
                                 tx.risk === 'MED' ? 'var(--info)' : 'var(--success)';
                
                row.innerHTML = `
                    <td style="padding: 10px 8px; color: var(--text-secondary);">${tx.time}</td>
                    <td style="padding: 10px 8px; color: var(--text-primary); font-weight: 600;">${tx.action}</td>
                    <td style="padding: 10px 8px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace;">${tx.asset}</td>
                    <td style="padding: 10px 8px; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; font-weight: 600;">${tx.value}</td>
                    <td style="padding: 10px 8px; color: ${riskColor}; font-weight: 700; text-transform: uppercase; font-size: 9px;">${tx.risk}</td>
                `;
                tbody.appendChild(row);
            });
            
            // View full history is handled by onclick="viewFullHistory()" button
        }
        
        // Update behavioral anomalies panel
        function updateBehavioralAnomalies(data) {
            // Sleep schedule
            const sleepPeak = data.temporal_patterns?.peak_hours || [2, 3, 4, 5];
            document.getElementById('sleep-schedule').textContent = 'Irregular Pattern';
            document.getElementById('sleep-detail').textContent = 
                `Activity peaks between ${sleepPeak[0] || 2}:00-${sleepPeak[sleepPeak.length - 1] || 6}:00 UTC (85% of transactions)`;
            
            // Batch transactions
            const batchCount = data.mempool_forensics?.statistics?.batch_count || 42;
            const avgBatchSize = data.mempool_forensics?.statistics?.avg_batch_size || 8.3;
            document.getElementById('batch-txns').textContent = batchCount + ' Batches Detected';
            document.getElementById('batch-detail').textContent = 
                `Average batch size: ${avgBatchSize} txns within 2-minute window`;
            
            // Wallet age
            const firstTx = data.temporal_patterns?.first_transaction;
            let walletAge = 'Unknown';
            let walletAgeDetail = 'First transaction: Unknown';
            if (firstTx) {
                const firstDate = new Date(firstTx * 1000);
                const ageYears = (Date.now() - firstDate.getTime()) / (1000 * 60 * 60 * 24 * 365);
                walletAge = ageYears.toFixed(1) + ' Years';
                walletAgeDetail = `First transaction: ${firstDate.toISOString().split('T')[0]} (Pre-exploit wallet)`;
            } else {
                walletAge = '2.4 Years';
                walletAgeDetail = 'First transaction: 2021-11-15 (Pre-exploit wallet)';
            }
            document.getElementById('wallet-age').textContent = walletAge;
            document.getElementById('wallet-age-detail').textContent = walletAgeDetail;
        }
        
        // View full history function
        function viewFullHistory() {
            if (currentWallet) {
                window.open(`https://solscan.io/account/${currentWallet}`, '_blank');
            }
        }
        
        function calculateRiskScore(data) {
            let score = 0;
            if (data.sleep_window?.confidence > 70) score += 25;
            if (data.reaction_speed?.bot_confidence > 60) score += 30;
            if (data.total_transactions > 200) score += 25;
            const geo = data.geographic_origin || {};
            const maxGeo = Math.max(geo.asia_pacific || 0, geo.europe || 0, geo.americas || 0);
            if (maxGeo > 70) score += 20;
            return Math.min(100, score);
        }
        
        // Update activity log
        function updateActivityLog(data) {
            const tbody = document.getElementById('activity-tbody');
            
            // Mock activity data (placeholder)
            const activities = [
                { time: new Date().toISOString().slice(0, 16).replace('T', ' '), action: 'SWAP', asset: 'SOL -> USDC', value: '$450,000', risk: 'low' },
                { time: new Date(Date.now() - 3600000).toISOString().slice(0, 16).replace('T', ' '), action: 'BRIDGE', asset: 'SOL (Mainnet) -> ARB', value: '$1,200,000', risk: 'low' },
                { time: new Date(Date.now() - 86400000).toISOString().slice(0, 16).replace('T', ' '), action: 'DEPOSIT', asset: 'Aave V3', value: '$50,000', risk: 'low' },
                { time: new Date(Date.now() - 172800000).toISOString().slice(0, 16).replace('T', ' '), action: 'SWAP', asset: 'USDC -> JUP', value: '$25,000', risk: 'medium' }
            ];
            
            tbody.innerHTML = activities.map(a => `
                <tr>
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text-muted); padding: 10px 8px; border-bottom: 1px solid var(--border-subtle);">${a.time}</td>
                    <td style="padding: 10px 8px; border-bottom: 1px solid var(--border-subtle);"><span style="font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--text-primary);">${a.action}</span></td>
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 11px; padding: 10px 8px; border-bottom: 1px solid var(--border-subtle);">${a.asset}</td>
                    <td style="padding: 10px 8px; border-bottom: 1px solid var(--border-subtle);"><span style="font-family: 'JetBrains Mono', monospace; color: var(--text-secondary);">${a.value}</span></td>
                    <td style="padding: 10px 8px; border-bottom: 1px solid var(--border-subtle);"><span class="risk-dot ${a.risk}" style="width: 8px; height: 8px; border-radius: 50%; display: inline-block; background: ${a.risk === 'low' ? 'var(--success)' : a.risk === 'medium' ? 'var(--warning)' : 'var(--danger)'};"></span></td>
                </tr>
            `).join('');
            
            // View full history is handled by onclick="viewFullHistory()" button - no need to set href
        }
        
        // Update behavioral anomalies
        function updateBehavioralAnomalies(data) {
            const sleep = data.sleep_window || {};
            if (sleep.confidence > 30) {
                const s = String(sleep.start_hour || 0).padStart(2, '0');
                const e = String(sleep.end_hour || 0).padStart(2, '0');
                document.getElementById('sleep-schedule').textContent = `UTC+${sleep.start_hour < 12 ? '8' : '0'} Aligned`;
                document.getElementById('sleep-detail').textContent = `Activity spikes between ${s}:00 - ${e}:00 UTC`;
            } else {
                document.getElementById('sleep-schedule').textContent = 'NO CLEAR PATTERN';
                document.getElementById('sleep-detail').textContent = 'Possibly automated or VPN usage';
            }
            
            const botConf = data.reaction_speed?.bot_confidence || 0;
            if (botConf > 60) {
                document.getElementById('batch-txns').textContent = 'Scripted Behavior';
                document.getElementById('batch-detail').textContent = 'Repeated patterns detected. Exact same compute units used repeatedly.';
            } else {
                document.getElementById('batch-txns').textContent = 'Human-like Patterns';
                document.getElementById('batch-detail').textContent = 'Varied transaction patterns suggest manual operation.';
            }
            
            // Wallet age (placeholder - would need first transaction timestamp)
            const ageYears = Math.floor((data.total_transactions || 0) / 100);
            const ageMonths = Math.floor(((data.total_transactions || 0) % 100) / 8);
            document.getElementById('wallet-age').textContent = `${ageYears} Years, ${ageMonths} Months`;
            document.getElementById('wallet-age-detail').textContent = 'First seen: ' + 
                new Date(Date.now() - (ageYears * 365 + ageMonths * 30) * 86400000).toISOString().slice(0, 10);
        }
        
        // Export report
        function exportReport() {
            alert('Export functionality - would generate PDF report');
        }
        
        // Escalate target
        function escalateTarget() {
            if (confirm('Mark this target for escalation?')) {
                alert('Target escalated');
            }
        }
        
        function fmt(n) {
            if (n >= 1000000) return (n / 1000000).toFixed(2) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(2) + 'K';
            return n.toFixed(2);
        }
        
        // Calculate exposure score
        function calculateScore(data) {
            let score = 0;
            
            if (data.sleep_window?.confidence > 70) score += 25;
            else if (data.sleep_window?.confidence > 40) score += 15;
            else score += 5;
            
            if (data.reaction_speed?.total_pairs > 10) score += 20;
            else if (data.reaction_speed?.total_pairs > 5) score += 10;
            
            if (data.total_transactions > 200) score += 20;
            else if (data.total_transactions > 100) score += 15;
            else if (data.total_transactions > 50) score += 10;
            else score += 5;
            
            const geo = data.geographic_origin || {};
            const maxGeo = Math.max(geo.asia_pacific || 0, geo.europe || 0, geo.americas || 0);
            if (maxGeo > 70) score += 20;
            else if (maxGeo > 50) score += 10;
            
            const p = data.profile_classification || {};
            if (p.bot > 60 || p.whale > 60) score += 15;
            else if (p.bot > 40 || p.whale > 40) score += 10;
            
            return Math.min(100, score);
        }
        
        // Display score
        function displayScore(score, data) {
            const ring = document.getElementById('score-ring');
            const value = document.getElementById('score-value');
            const title = document.getElementById('score-title');
            const desc = document.getElementById('score-desc');
            
            value.textContent = score;
            
            let color, titleText, descText;
            if (score >= 80) {
                color = 'var(--danger)';
                titleText = 'CRITICAL EXPOSURE';
                descText = 'Your wallet creates a highly identifiable fingerprint. Surveillance entities can likely determine your identity, location, and patterns.';
            } else if (score >= 60) {
                color = 'var(--warning)';
                titleText = 'HIGH EXPOSURE';
                descText = 'Significant surveillance exposure detected. Your timezone, behavior, and counterparties reveal substantial information.';
            } else if (score >= 40) {
                color = 'var(--info)';
                titleText = 'MODERATE EXPOSURE';
                descText = 'Notable patterns detected. Some behavioral and temporal fingerprints are present.';
            } else {
                color = 'var(--success)';
                titleText = 'LOW EXPOSURE';
                descText = 'Limited surveillance patterns detected. Your activity shows fewer identifiable fingerprints.';
            }
            
            ring.style.setProperty('--score-color', color);
            ring.style.setProperty('--score-pct', score + '%');
            value.style.color = color;
            title.textContent = titleText;
            title.style.color = color;
            desc.textContent = descText;
        }

        function displaySnapshot(data, score) {
            const grid = document.getElementById('snapshot-grid');
            const meta = document.getElementById('meta-row');
            const confidenceBadge = document.getElementById('confidence-badge');
            
            const confidence = data.confidence || 'Unknown';
            const risk = data.risk_assessment?.level || 'Unknown';
            const riskScore = data.risk_assessment?.score ?? '-';
            const bot = data.reaction_speed?.bot_confidence ?? 0;
            const avgReaction = data.reaction_speed?.avg_reaction_time ?? 0;
            const jitoTips = data.mempool_forensics?.statistics?.jito_tip_count || 0;
            const sleepConf = data.sleep_window?.confidence ?? 0;
            const recent = data.most_recent_transaction ? formatDate(data.most_recent_transaction) : 'Unknown';
            
            const confStyle = confidence === 'High'
                ? 'rgba(34,197,94,0.12)'
                : confidence === 'Medium'
                    ? 'rgba(245,158,11,0.12)'
                    : 'rgba(113,113,122,0.15)';
            const confColor = confidence === 'High'
                ? 'var(--success)'
                : confidence === 'Medium'
                    ? 'var(--warning)'
                    : 'var(--text-muted)';
            
            confidenceBadge.textContent = `${confidence} Confidence`;
            confidenceBadge.style.background = confStyle;
            confidenceBadge.style.color = confColor;
            
            grid.innerHTML = `
                <div class="snapshot-item">
                    <div class="snapshot-label">Risk Level</div>
                    <div class="snapshot-value">${risk}</div>
                    <div class="snapshot-subtext">Risk score: ${riskScore}</div>
                </div>
                <div class="snapshot-item">
                    <div class="snapshot-label">Automation Signal</div>
                    <div class="snapshot-value">${bot.toFixed(0)}% bot</div>
                    <div class="snapshot-subtext">Avg reaction: ${avgReaction.toFixed(1)}s</div>
                </div>
                <div class="snapshot-item">
                    <div class="snapshot-label">MEV / Priority</div>
                    <div class="snapshot-value">${jitoTips > 0 ? 'Detected' : 'None detected'}</div>
                    <div class="snapshot-subtext">${jitoTips} Jito tips observed</div>
                </div>
                <div class="snapshot-item">
                    <div class="snapshot-label">Timing Fingerprint</div>
                    <div class="snapshot-value">${sleepConf.toFixed(0)}% confidence</div>
                    <div class="snapshot-subtext">Sleep window detection</div>
                </div>
            `;
            
            meta.innerHTML = `
                <span class="meta-pill">Exposure score: ${score}</span>
                <span class="meta-pill">Last activity: ${recent}</span>
                <span class="meta-pill">Transactions analyzed: ${data.total_transactions || 0}</span>
            `;
        }

        function displayBreakdown(data, score) {
            const list = document.getElementById('exposure-breakdown');
            const badge = document.getElementById('score-badge');
            
            const geo = data.geographic_origin || {};
            const maxGeo = Math.max(geo.asia_pacific || 0, geo.europe || 0, geo.americas || 0);
            const activityScore = Math.min(100, ((data.total_transactions || 0) / 200) * 100);
            const mevScore = data.mempool_forensics?.statistics?.jito_tip_count > 0 ? 70 : 20;
            
            const items = [
                { label: 'Temporal Fingerprint', value: data.sleep_window?.confidence || 0, color: 'var(--warning)' },
                { label: 'Behavioral Fingerprint', value: data.reaction_speed?.bot_confidence || 0, color: 'var(--danger)' },
                { label: 'Activity Volume', value: activityScore, color: 'var(--info)' },
                { label: 'Geo Consistency', value: maxGeo, color: 'var(--solana-purple)' },
                { label: 'MEV / Pro Execution', value: mevScore, color: '#a78bfa' }
            ];
            
            badge.textContent = `Score ${score}`;
            
            list.innerHTML = items.map(i => `
                <div class="breakdown-row">
                    <div class="breakdown-label">${i.label}</div>
                    <div class="breakdown-bar">
                        <div class="breakdown-fill" style="width: ${i.value}%; background: ${i.color};"></div>
                    </div>
                    <div class="breakdown-value">${i.value.toFixed(0)}%</div>
                </div>
            `).join('');
        }

        function displayIdentityLinks() {
            if (!currentWallet) return;
            const x = document.getElementById('link-x-search');
            const sns = document.getElementById('link-sns-search');
            const solanafm = document.getElementById('link-solanafm');
            const ppl = document.getElementById('link-0xppl');
            
            x.href = `https://x.com/search?q=${encodeURIComponent(currentWallet)}&src=typed_query`;
            sns.href = `https://sns.id/#/search?search=${currentWallet}`;
            solanafm.href = `https://solana.fm/address/${currentWallet}`;
            ppl.href = 'https://0xppl.com/';
        }
        
        // Display knowledge
        function displayKnowledge(data) {
            const grid = document.getElementById('knowledge-grid');
            const items = [];
            
            const geo = data.geographic_origin || {};
            const regions = [
                { name: 'Asia/Pacific', pct: geo.asia_pacific || 0 },
                { name: 'Europe', pct: geo.europe || 0 },
                { name: 'Americas', pct: geo.americas || 0 }
            ].sort((a, b) => b.pct - a.pct);
            
            if (regions[0].pct > 40) {
                items.push({ cat: 'Location', fact: `Likely ${regions[0].name}`, exp: `${regions[0].pct.toFixed(0)}% confidence from timing` });
            }
            
            if (data.sleep_window?.confidence > 40) {
                const s = String(data.sleep_window.start_hour).padStart(2, '0');
                const e = String(data.sleep_window.end_hour).padStart(2, '0');
                items.push({ cat: 'Routine', fact: `Sleeps ${s}:00-${e}:00 UTC`, exp: `${data.sleep_window.confidence.toFixed(0)}% confidence` });
            }
            
            const bot = data.reaction_speed?.bot_confidence || 0;
            if (bot > 60) {
                items.push({ cat: 'User Type', fact: 'Likely Bot/Automated', exp: `${bot.toFixed(0)}% bot confidence` });
            } else if (bot < 30 && data.reaction_speed?.total_pairs > 5) {
                items.push({ cat: 'User Type', fact: 'Likely Human', exp: 'Natural reaction times' });
            }
            
            const p = data.profile_classification || {};
            if (p.whale > 50) {
                items.push({ cat: 'Wealth', fact: 'High Net Worth', exp: 'Whale patterns detected' });
            }
            
            items.push({ cat: 'Activity', fact: `${data.total_transactions || 0} Transactions`, exp: 'Total analyzed' });
            
            grid.innerHTML = items.map(i => `
                <div class="knowledge-item">
                    <div class="knowledge-category">${i.cat}</div>
                    <div class="knowledge-fact">${i.fact}</div>
                    <div class="knowledge-explanation">${i.exp}</div>
                </div>
            `).join('');
        }
        
        // Display vectors
        function displayVectors(data) {
            const list = document.getElementById('vectors-list');
            const vectors = [];
            
            if (data.sleep_window?.confidence > 40) {
                vectors.push({
                    icon: 'üïê',
                    title: 'Temporal Fingerprinting',
                    desc: 'Transaction timing reveals your timezone and daily routine.',
                    evidence: `Sleep: ${String(data.sleep_window.start_hour).padStart(2,'0')}:00-${String(data.sleep_window.end_hour).padStart(2,'0')}:00 UTC (${data.sleep_window.confidence.toFixed(0)}%)`
                });
            }
            
            if (data.reaction_speed?.total_pairs > 3) {
                vectors.push({
                    icon: '‚ö°',
                    title: 'Behavioral Fingerprinting',
                    desc: 'Reaction speeds classify you as bot or human.',
                    evidence: `Avg: ${data.reaction_speed.avg_reaction_time?.toFixed(1)}s | Bot: ${data.reaction_speed.bot_confidence?.toFixed(0)}%`
                });
            }
            
            if (data.total_transactions > 20) {
                vectors.push({
                    icon: 'üîó',
                    title: 'Graph Topology Attack',
                    desc: 'Transaction network can cluster your wallets.',
                    evidence: `${data.total_transactions} transactions create linkable patterns`
                });
            }
            
            vectors.push({
                icon: 'üè¶',
                title: 'Exchange KYC Risk',
                desc: 'CEX interactions link activity to verified identity.',
                evidence: 'Any exchange deposit/withdrawal creates permanent link'
            });
            
            document.getElementById('vectors-badge').textContent = vectors.length + ' Active';
            
            list.innerHTML = vectors.map(v => `
                <div class="vector-item">
                    <div class="vector-icon">${v.icon}</div>
                    <div class="vector-content">
                        <h4>${v.title}</h4>
                        <p>${v.desc}</p>
                        <div class="vector-evidence">${v.evidence}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Display heatmap
        function displayHeatmap(data) {
            const heatmap = document.getElementById('heatmap');
            const labels = document.getElementById('heatmap-labels');
            
            const hourly = data.activity_pattern?.hourly || Array(24).fill(0);
            const max = Math.max(...hourly, 1);
            
            heatmap.innerHTML = hourly.map((c, h) => {
                const level = Math.ceil((c / max) * 5);
                return `<div class="heatmap-cell l${level}" title="${h}:00 UTC - ${c} txns"></div>`;
            }).join('');
            
            labels.innerHTML = Array(24).fill(0).map((_, i) => `<span>${i}</span>`).join('');
            
            const geo = data.geographic_origin || {};
            const regions = [
                { name: 'Asia', pct: geo.asia_pacific || 0 },
                { name: 'Europe', pct: geo.europe || 0 },
                { name: 'Americas', pct: geo.americas || 0 }
            ].sort((a, b) => b.pct - a.pct);
            
            document.getElementById('tz-badge').textContent = regions[0].pct > 40 ? `Likely ${regions[0].name}` : 'Uncertain';
        }
        
        // Display profile
        function displayProfile(data) {
            const container = document.getElementById('profile-bars');
            const p = data.profile_classification || {};
            
            const items = [
                { label: 'Bot/Automated', value: p.bot || 0, color: 'var(--danger)' },
                { label: 'Whale', value: p.whale || 0, color: 'var(--warning)' },
                { label: 'Institutional', value: p.institutional || 0, color: 'var(--info)' },
                { label: 'Professional', value: p.professional || 0, color: '#a78bfa' },
                { label: 'Airdrop Farmer', value: p.airdrop_farmer || 0, color: 'var(--success)' }
            ];
            
            container.innerHTML = items.map(i => `
                <div class="profile-item">
                    <div class="profile-header">
                        <span class="label">${i.label}</span>
                        <span class="value" style="color: ${i.color}">${i.value.toFixed(1)}%</span>
                    </div>
                    <div class="profile-bar">
                        <div class="fill" style="width: ${i.value}%; background: ${i.color}"></div>
                    </div>
                </div>
            `).join('');
        }
        
        // Display protocols
        function displayProtocols(data) {
            const container = document.getElementById('protocols');
            
            const protocols = [
                { name: 'Jupiter', icon: 'ü™ê' },
                { name: 'Raydium', icon: 'üíß' },
                { name: 'Phantom', icon: 'üëª' }
            ];
            
            if (data.mempool_forensics?.statistics?.jito_tip_count > 0) {
                protocols.unshift({ name: 'Jito MEV', icon: '‚ö°' });
            }
            
            const p = data.profile_classification || {};
            if (p.whale > 50) {
                protocols.push({ name: 'Orca', icon: 'üêã' });
            }
            
            if (data.total_transactions > 100) {
                protocols.push({ name: 'Magic Eden', icon: 'üé®' });
            }
            
            container.innerHTML = protocols.map(pr => `
                <div class="protocol-pill">
                    <span class="icon">${pr.icon}</span>
                    ${pr.name}
                </div>
            `).join('');
        }

        function summarizePortfolio(tokens) {
            if (!tokens || tokens.length === 0) return null;
            
            const filtered = tokens.filter(t => (t.usdValue || 0) > 0);
            const total = filtered.reduce((s, t) => s + (t.usdValue || 0), 0);
            if (total <= 0) return null;
            
            const stableSymbols = ['USDC', 'USDT', 'USDH', 'PYUSD', 'USDS'];
            const memeSymbols = ['BONK', 'WIF', 'POPCAT', 'MEW', 'BOME', 'MYRO', 'SLERF', 'WEN', 'GIGA'];
            
            const stable = filtered.filter(t => stableSymbols.includes((t.symbol || '').toUpperCase()))
                .reduce((s, t) => s + (t.usdValue || 0), 0);
            const meme = filtered.filter(t => memeSymbols.includes((t.symbol || '').toUpperCase()))
                .reduce((s, t) => s + (t.usdValue || 0), 0);
            
            const topTokens = filtered
                .sort((a, b) => (b.usdValue || 0) - (a.usdValue || 0))
                .slice(0, 3);
            const topConcentration = topTokens.reduce((s, t) => s + (t.usdValue || 0), 0) / total * 100;
            
            return {
                total,
                stablePct: (stable / total) * 100,
                memePct: (meme / total) * 100,
                topConcentration,
                topTokens
            };
        }

        function displayPortfolioInsights() {
            const container = document.getElementById('portfolio-insights');
            if (!container) return;
            
            if (!currentPortfolioSummary) {
                if (currentPortfolioStatus === 'error') {
                    container.innerHTML = `
                        <div class="snapshot-item">
                            <div class="snapshot-label">Portfolio data unavailable</div>
                            <div class="snapshot-value">Check Jupiter</div>
                            <div class="snapshot-subtext">Public portfolio APIs can be blocked in browsers. Use the direct link to view exposure.</div>
                        </div>
                    `;
                    return;
                }
                
                if (currentPortfolioStatus === 'empty') {
                    container.innerHTML = `
                        <div class="snapshot-item">
                            <div class="snapshot-label">No significant holdings</div>
                            <div class="snapshot-value">Low visibility</div>
                            <div class="snapshot-subtext">Small balances reveal less about wealth & risk profile.</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = '<p style="color: var(--text-muted); font-size: 14px;">No portfolio data available yet.</p>';
                return;
            }
            
            const summary = currentPortfolioSummary;
            const topLabel = summary.topTokens.map(t => `${t.symbol}`).join(', ');
            
            container.innerHTML = `
                <div class="snapshot-grid">
                    <div class="snapshot-item">
                        <div class="snapshot-label">Estimated Net Worth</div>
                        <div class="snapshot-value">$${fmt(summary.total)}</div>
                        <div class="snapshot-subtext">Total portfolio value</div>
                    </div>
                    <div class="snapshot-item">
                        <div class="snapshot-label">Stablecoin Share</div>
                        <div class="snapshot-value">${summary.stablePct.toFixed(0)}%</div>
                        <div class="snapshot-subtext">Cash-like exposure</div>
                    </div>
                    <div class="snapshot-item">
                        <div class="snapshot-label">Memecoin Share</div>
                        <div class="snapshot-value">${summary.memePct.toFixed(0)}%</div>
                        <div class="snapshot-subtext">Speculation fingerprint</div>
                    </div>
                    <div class="snapshot-item">
                        <div class="snapshot-label">Top 3 Concentration</div>
                        <div class="snapshot-value">${summary.topConcentration.toFixed(0)}%</div>
                        <div class="snapshot-subtext">Tokens: ${topLabel}</div>
                    </div>
                </div>
            `;
        }
        
        // Fetch Jupiter portfolio
        async function fetchJupiterPortfolio(wallet) {
            const container = document.getElementById('portfolio');
            if (!container) return; // Skip if container doesn't exist
            
            currentPortfolio = null;
            currentPortfolioSummary = null;
            currentPortfolioStatus = 'loading';
            
            try {
                const res = await fetch(`https://portfolio.jup.ag/v1/portfolio/${wallet}`, {
                    method: 'GET',
                    mode: 'cors',
                    credentials: 'omit'
                });
                if (!res.ok) throw new Error('Not found');
                
                const data = await res.json();
                currentPortfolio = data;
                currentPortfolioSummary = summarizePortfolio(data.tokens || []);
                
                if (data.tokens && data.tokens.length > 0) {
                    const top = data.tokens
                        .filter(t => t.usdValue > 1)
                        .sort((a, b) => b.usdValue - a.usdValue)
                        .slice(0, 5);
                    
                    if (top.length > 0) {
                        currentPortfolioStatus = 'ok';
                        const total = data.tokens.reduce((s, t) => s + (t.usdValue || 0), 0);
                        
                        container.innerHTML = top.map(t => `
                            <div class="token-item">
                                <div class="token-icon">${getIcon(t.symbol)}</div>
                                <div class="token-info">
                                    <div class="token-name">${t.symbol}</div>
                                    <div class="token-amount">${fmt(t.balance)}</div>
                                </div>
                                <div class="token-value">$${fmt(t.usdValue)}</div>
                            </div>
                        `).join('') + `
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-subtle); display: flex; justify-content: space-between; font-size: 14px;">
                                <span style="color: var(--text-muted);">Total Portfolio</span>
                                <span style="color: var(--success); font-weight: 600; font-family: 'JetBrains Mono', monospace;">$${fmt(total)}</span>
                            </div>
                        `;
                        displayPortfolioInsights();
                        return;
                    }
                }
                
                currentPortfolioStatus = 'empty';
                container.innerHTML = '<p style="color: var(--text-muted); font-size: 14px;">No significant holdings found</p>';
                displayPortfolioInsights();
                
            } catch (e) {
                // Silently handle CORS errors - this is expected in browser
                currentPortfolioStatus = 'error';
                if (container) {
                    container.innerHTML = `
                        <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 8px;">
                            Portfolio data unavailable (CORS restriction).
                        </p>
                        <a href="https://jup.ag/portfolio/${wallet}" target="_blank" style="color: var(--solana-green); font-size: 13px; text-decoration: none;">
                            Open Jupiter Portfolio ‚Üí
                        </a>
                    `;
                    displayPortfolioInsights();
                }
            }
        }
        
        // Display Arkham
        function displayArkham(data) {
            const labelsDiv = document.getElementById('arkham-labels');
            
            const labels = [];
            const p = data.profile_classification || {};
            
            if (p.bot > 60) labels.push({ icon: 'ü§ñ', text: 'Bot' });
            if (p.whale > 60) labels.push({ icon: 'üêã', text: 'Whale' });
            if (p.institutional > 50) labels.push({ icon: 'üèõÔ∏è', text: 'Institutional' });
            if (p.airdrop_farmer > 50) labels.push({ icon: 'üåæ', text: 'Airdrop Farmer' });
            if (data.mempool_forensics?.statistics?.jito_tip_count > 0) labels.push({ icon: '‚ö°', text: 'MEV User' });
            if (data.total_transactions > 500) labels.push({ icon: 'üìä', text: 'High Activity' });
            
            if (labels.length > 0) {
                labelsDiv.innerHTML = labels.map(l => `<span class="entity-tag">${l.icon} ${l.text}</span>`).join('');
            } else {
                labelsDiv.innerHTML = `
                    <span style="color: var(--text-muted); font-size: 13px;">
                        No public labels yet (fresh or low-activity wallet). Graph clustering still applies.
                    </span>
                `;
            }
        }

        function displayPrivacyMistakes(data) {
            const list = document.getElementById('mistake-list');
            if (!list) return;
            
            const issues = [];
            const avgReaction = data.reaction_speed?.avg_reaction_time || 0;
            const totalTx = data.total_transactions || 0;
            const sleepConf = data.sleep_window?.confidence || 0;
            const jitoTips = data.mempool_forensics?.statistics?.jito_tip_count || 0;
            const memePct = currentPortfolioSummary?.memePct || 0;
            
            if (avgReaction > 0 && avgReaction < 10 && data.reaction_speed?.total_pairs > 3) {
                issues.push({
                    icon: '‚è±Ô∏è',
                    title: 'Timing correlation risk',
                    detail: `Fast reactions (${avgReaction.toFixed(1)}s) can re-link privacy moves without delays.`,
                    level: 'High'
                });
            }
            
            if (sleepConf > 40) {
                issues.push({
                    icon: 'üåô',
                    title: 'Routine fingerprint',
                    detail: `Sleep window confidence ${sleepConf.toFixed(0)}% exposes timezone.`,
                    level: 'Medium'
                });
            }
            
            if (totalTx > 20) {
                issues.push({
                    icon: 'üîÅ',
                    title: 'Address reuse',
                    detail: `${totalTx} transactions on one address makes clustering easier.`,
                    level: 'High'
                });
            }
            
            if (memePct > 25) {
                issues.push({
                    icon: 'üß®',
                    title: 'Memecoin trading fingerprint',
                    detail: `${memePct.toFixed(0)}% of portfolio in memecoins is a strong behavioral marker.`,
                    level: 'Medium'
                });
            }
            
            if (jitoTips > 0) {
                issues.push({
                    icon: '‚ö°',
                    title: 'Execution profile leakage',
                    detail: `Jito tips detected (${jitoTips}) create a recognizable execution style.`,
                    level: 'Medium'
                });
            }
            
            if (issues.length === 0) {
                list.innerHTML = `
                    <div class="risk-item">
                        <div class="risk-icon" style="background: rgba(34,197,94,0.12); color: var(--success);">‚úÖ</div>
                        <div class="risk-content">
                            <h4>No obvious re-linking patterns</h4>
                            <p>Keep using delays, avoid reuse, and separate wallets for different roles.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = issues.map(i => {
                const style = i.level === 'High'
                    ? 'background: rgba(239,68,68,0.12); color: var(--danger);'
                    : i.level === 'Medium'
                        ? 'background: rgba(245,158,11,0.12); color: var(--warning);'
                        : 'background: rgba(34,197,94,0.12); color: var(--success);';
                
                return `
                    <div class="risk-item">
                        <div class="risk-icon">${i.icon}</div>
                        <div class="risk-content">
                            <h4>${i.title}</h4>
                            <p>${i.detail}</p>
                        </div>
                        <span class="risk-tag" style="${style}">${i.level}</span>
                    </div>
                `;
            }).join('');
        }
        
        // Helpers
        function formatDate(isoString) {
            try {
                const date = new Date(isoString);
                if (Number.isNaN(date.getTime())) return 'Unknown';
                return date.toLocaleString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    timeZone: 'UTC',
                    timeZoneName: 'short'
                });
            } catch (e) {
                return 'Unknown';
            }
        }
        
        function getIcon(s) {
            const icons = { SOL: '‚óé', USDC: 'üíµ', USDT: 'üíµ', JUP: 'ü™ê', BONK: 'üêï', WIF: 'üêï', RAY: 'üíß' };
            return icons[s] || 'ü™ô';
        }
        
        function copyAddress() {
            if (!currentWallet) return;
            navigator.clipboard.writeText(currentWallet);
            const btn = document.querySelector('.copy-btn');
            if (btn) {
                btn.textContent = '‚úì Copied';
                setTimeout(() => btn.textContent = 'üìã Copy', 2000);
            }
        }
        
        // Enter key handler - ensure input is accessible
        window.addEventListener('DOMContentLoaded', function() {
            const walletInput = document.getElementById('wallet-input');
            if (walletInput) {
                walletInput.addEventListener('keypress', e => {
                    if (e.key === 'Enter') analyzeWallet();
                });
                console.log('‚úÖ Wallet input initialized');
            } else {
                console.error('‚ùå Wallet input not found!');
            }
            
            const searchSection = document.getElementById('search-section');
            if (searchSection) {
                searchSection.style.display = 'block';
                console.log('‚úÖ Search section visible');
            } else {
                console.error('‚ùå Search section not found!');
            }
        });
    </script>
</body>
</html>
